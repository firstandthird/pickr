
/*!
 * pickr - A javascript datepicker
 * v0.3.2
 * https://github.com/firstandthird/pickr
 * copyright First + Third 2014
 * MIT License
*/
!function(a){a.declare("pickr",{defaults:{hideDelay:150,displayMonths:1,template:'<div class="pickr-months">  <button type="button" class="pickr-prev-month">&lsaquo;</button>  <button type="button" class="pickr-next-month">&rsaquo;</button>  <% for (var i = 0; i < months.length; i++) { var month = months[i]; %>    <div class="pickr-month" data-pickr-date="<%= month.date %>">      <div class="pickr-month-title">        <%= timef(\'%F\', month.date) %>        <% if(today.getFullYear() !== month.date.getFullYear()) { %>          &nbsp; <span><%= timef(\'(%Y)\', month.date) %></span>        <% } %>      </div>      <div class="pickr-days">        <div class="pickr-days-labels">          <% for(var l = 0; l < dayLabels.length; l++) { %>          <div class="pickr-days-label"><%= dayLabels[l] %></div>          <% } %>        </div>                <% if(month.start > 0) { %>        <div class="pickr-day-buffer">          <% for(var d = 1; d < month.start+1; d++) { %>          <div class="pickr-empty-day">&nbsp;</div>          <% } %>        </div>        <% } %>        <% for(var d = 1; d < month.days+1; d++) { %>        <% var isToday = (today.getMonth() === month.date.getMonth() && today.getDate() === d); %>        <% var isSelected = month.selected.indexOf(d) > -1; %>        <% var isPastDay = (!allowPastDays && ~~timef(\'%Y%m%d\', new Date(month.date.getFullYear(), month.date.getMonth(), d)) < ~~timef(\'%Y%m%d\', today)); %>        <div class="pickr-day<%= isToday ? \' pickr-today\' : \'\' %><%= isPastDay ? \' pickr-past\' : \'\' %><%= isSelected ? \' pickr-day--selected\' : \'\' %>"><%= d %></div>        <% } %>        <% if(month.end > 0) { %>        <div class="pickr-day-buffer">          <% for(var d = 1; d < month.end+1; d++) { %>          <div class="pickr-empty-day">&nbsp;</div>          <% } %>        </div>        <% } %>      </div>    </div>  <% } %></div>',currentMonth:new Date,dayLabels:["Su","Mo","Tu","We","Th","Fr","Sa"],dateFormat:"%Y-%m-%d",allowPastDays:!0,inline:!1,multiple:!1},init:function(){this.el.addClass("pickr"),this.pickrContainer=a("<div></div>").addClass("pickr-container"),this.el.after(this.pickrContainer),this.inline="input"!==this.el.prop("tagName").toLowerCase()||this.inline,this.focus=!1,this.value=[],this.selectedDate={},this.currentMonth=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth(),1),this.el.data("pickr-format")&&(this.dateFormat=this.el.data("pickr-format")),this.bindEvents(),this.inline&&(this.pickrContainer.addClass("pickr-inline"),this.showModal())},bindEvents:function(){this.inline||(this.el.on("focus",this.proxy(this.showModal)),this.el.on("blur",this.proxy(this.hideModal))),this.pickrContainer.on("click",this.proxy(this.containerClicked)),this.pickrContainer.on("click","*",this.proxy(this.containerClicked))},update:function(){var b,c,d=[];for(b=0;b<this.displayMonths;b++)c=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+b,1),d.push({date:c,selected:this.selectedInMonth(c),days:this.daysInMonth(c),start:this.monthStartIndex(c),end:this.monthEndIndex(c)});var e={timef:dateFormat,months:d,dayLabels:this.dayLabels,today:new Date,allowPastDays:this.allowPastDays};this.render(e,this.pickrContainer),this.pickrContainer.find(".pickr-empty-day, .pickr-day").each(function(b){b%7===0&&a(this).addClass("pickr-day-first")})},showModal:function(){if(!this.focus){if(this.focus=!0,!this.inline){var a=this.el.offset();this.pickrContainer.css({left:a.left,top:a.top+this.el.outerHeight()})}this.update()}},hideModal:function(a){a.preventDefault(),this.hideTimer=setTimeout(this.proxy(function(){this.pickrContainer.empty(),this.focus=!1}),this.hideDelay)},containerClicked:function(b){b.stopPropagation(),b.preventDefault(),clearTimeout(this.hideTimer),this.focus=!0,this.inline||this.el.focus();var c=a(b.target);if(c.is(".pickr-day")&&!c.is(".pickr-past")){var d=c.text(),e=new Date(c.parents(".pickr-month").data("pickr-date"));if(c.is(".pickr-day--selected"))this.multiple!==!1&&(c.removeClass("pickr-day--selected"),this.removeDate(e));else{if(e.setDate(d),this.multiple===!1)this.pickrContainer.find(".pickr-day--selected").removeClass("pickr-day--selected");else if(!this.canAddMoreDates())return;c.addClass("pickr-day--selected"),this.selectDate(e)}}c.is(".pickr-prev-month")&&this.prevMonth(),c.is(".pickr-next-month")&&this.nextMonth(),c.is(".pickr-month-title")&&this.today()},removeDate:function(a){var b=dateFormat(this.dateFormat,a),c=this.value.indexOf(b);this.value.splice(c,1);var d=this.selectedDate[this.getDateKey(a)],e=d.indexOf(a.getDate());d.splice(e,1),this.updateValue(this.value)},getDateKey:function(a){return a.getMonth()+"/"+a.getFullYear()},storeDate:function(a,b){this.value.length<this.multiple||this.multiple===!0?this.value.push(b):this.multiple===!1&&(this.value=[b],this.selectedDate={}),Array.isArray(this.selectedDate[this.getDateKey(a)])||(this.selectedDate[this.getDateKey(a)]=[]),this.selectedDate[this.getDateKey(a)].push(a.getDate())},selectDate:function(a){var b=dateFormat(this.dateFormat,a);this.storeDate(a,b),this.updateValue(this.value)},updateValue:function(a){this.el.trigger("pickr:selected",[a]),this.inline||(this.el.val(a.join(" ")),this.el.trigger("input"),this.el.blur())},canAddMoreDates:function(){return this.multiple?this.multiple?"number"===a.type(this.multiple)?this.value.length<this.multiple:!0:void 0:!0},selectedInMonth:function(a){return this.selectedDate[this.getDateKey(a)]||[]},daysInMonth:function(a){var b=new Date(a.getFullYear(),a.getMonth()+1,0);return b.getDate()},monthStartIndex:function(a){var b=new Date(a.getFullYear(),a.getMonth(),1);return b.getDay()},monthEndIndex:function(a){var b=new Date(a.getFullYear(),a.getMonth(),this.daysInMonth(a));return 6-b.getDay()},prevMonth:function(){this.currentMonth.setMonth(this.currentMonth.getMonth()-this.displayMonths),this.update()},nextMonth:function(){this.currentMonth.setMonth(this.currentMonth.getMonth()+this.displayMonths),this.update()},today:function(){this.currentMonth=new Date,this.update()}})}(jQuery);